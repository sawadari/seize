# ステークホルダーインタビュー - セキュリティチーム

**日時**: 2025年1月16日 14:00-15:30
**場所**: セキュリティ部門オフィス
**インタビュー対象**: 佐藤 花子（CISO - 最高情報セキュリティ責任者）
**インタビュアー**: 山田 次郎（開発リード）

---

## インタビュー目的

認証システムのセキュリティ要求を収集し、コンプライアンス要件を明確化する。

---

## セキュリティ上の懸念

### 1. 現行システムの脆弱性

> 「現在の認証システムには重大な脆弱性があります。パスワードの保存方法がMD5ハッシュで、これは2025年現在では非常に脆弱です。レインボーテーブル攻撃で簡単に解読されてしまいます。bcryptまたはArgon2への移行が必須です。」

**リスクレベル**: Critical（重大）

### 2. セッション管理の問題

> 「セッショントークンが予測可能な形式（連番など）で生成されています。これはセッションハイジャック攻撃に対して非常に脆弱です。暗号学的に安全な乱数生成器（CSPRNG）を使用する必要があります。」

**リスクレベル**: High（高）

### 3. HTTPS未対応ページの存在

> 「一部のページがHTTPのままです。認証情報がHTTPで送信されると、中間者攻撃（Man-in-the-Middle Attack）のリスクがあります。すべてのページをHTTPSに移行し、HSTSヘッダーを設定してください。」

**リスクレベル**: High（高）

---

## セキュリティ要求

### 認証メカニズム

#### パスワードハッシュ化

> 「パスワードは必ずbcryptでハッシュ化してください。ワークファクターは最低10、推奨は12です。Argon2も選択肢ですが、Rustエコシステムでの実績を考慮してbcryptを推奨します。」

**標準準拠**: OWASP Password Storage Cheat Sheet

#### ソルト

> 「各パスワードに対してユニークなソルトを生成してください。グローバルソルトは使用しないでください。bcryptは自動的にソルトを生成するので、正しく実装すれば問題ありません。」

#### パスワードポリシー

> 「NIST SP 800-63Bに準拠してください。具体的には：
> - 最低8文字（推奨は12文字以上）
> - 最大長の制限は64文字以上
> - よくあるパスワードのブラックリストチェック（例: 'password', '123456'）
> - パスワード強度メーター表示（オプション）
> - 定期的なパスワード変更の強制は不要（NIST推奨に反する）」

### 二要素認証（2FA）

#### TOTP実装

> 「Time-based One-Time Password (TOTP)をRFC 6238に準拠して実装してください。Google Authenticator、Authy、1Password等のアプリと互換性を持たせてください。」

**重要ポイント**:
- シークレットキーは最低128ビット
- タイムステップは30秒
- 時刻ずれ対策（±1ステップの許容）

#### バックアップコード

> 「ユーザーがスマートフォンを紛失した場合に備えて、10個のバックアップコードを生成してください。各コードは1回のみ使用可能で、使用後は無効化してください。」

### アカウント保護

#### レート制限

> 「ログイン試行に対してレート制限を実装してください：
> - 同一IPアドレスから1分間に10回まで
> - 同一アカウントに対して5分間に5回まで
> - 5回連続失敗でアカウントを15分間ロック
> - 10回連続失敗で管理者通知とログ記録」

#### アカウントロック

> 「ロック解除方法は以下のいずれか：
> - 15分間の自動ロック解除
> - メール認証によるロック解除
> - 管理者による手動ロック解除
>
> ただし、列挙攻撃（Enumeration Attack）を防ぐため、存在しないアカウントへの攻撃でもロック状態を返してください。」

### セッション管理

#### セッショントークン生成

> 「セッショントークンは以下の要件を満たしてください：
> - 最低128ビットのエントロピー
> - 暗号学的に安全な乱数生成器（CSPRNG）を使用
> - UUIDv4またはランダムな英数字列
> - 予測不可能であること」

#### セッションタイムアウト

> 「セッションタイムアウトは以下のように設定してください：
> - 通常ログイン: 30分の無操作でタイムアウト
> - 『ログイン状態を保持』: 30日間（ただしセキュアクッキー使用）
> - 絶対タイムアウト: 24時間でログアウト強制」

#### セッション無効化

> 「以下の場合、セッションを無効化してください：
> - ユーザーによるログアウト
> - パスワード変更時
> - 管理者によるアカウント停止
> - セキュリティインシデント検知時（異常なアクセスパターンなど）」

### OAuth 2.0 / ソーシャルログイン

#### プロバイダー選定

> 「Google、Facebook、Appleの3つを実装してください。特にAppleはiOSアプリを提供する場合、Apple Review Guidelinesで義務付けられています。」

#### セキュリティ考慮事項

> 「OAuth 2.0実装時の必須事項：
> - state パラメータによるCSRF保護
> - PKCE (Proof Key for Code Exchange) の使用
> - リダイレクトURIのホワイトリスト検証
> - スコープの最小化（必要な権限のみ要求）
> - トークンの安全な保管（暗号化してDB保存）」

---

## コンプライアンス要求

### GDPR準拠

#### Article 32: データ保護のセキュリティ

> 「以下を実装してください：
> - 個人データの暗号化（転送時: TLS 1.3、保管時: AES-256）
> - アクセス制御とログ記録
> - 定期的なセキュリティテスト
> - インシデント対応手順の確立」

#### Article 7: 同意

> 「ユーザーがソーシャルログインを使用する場合、以下の同意を取得してください：
> - データ共有の目的の明示
> - 同意の取り消し方法の提供
> - 同意履歴の記録」

#### Article 15-20: ユーザー権利

> 「ユーザーが自分のデータにアクセス、訂正、削除できる機能を提供してください。特にアカウント削除時は、個人データを完全に削除する必要があります（Right to be Forgotten）。」

### 個人情報保護法（日本）

> 「個人情報保護法に準拠し、以下を実装してください：
> - 利用目的の明示
> - 安全管理措置
> - 第三者提供の制限（ソーシャルログイン時の注意）
> - 開示請求への対応」

---

## ログとモニタリング

### セキュリティログ

> 「以下のイベントをログに記録してください：
> - ログイン成功/失敗（IP、UserAgent、タイムスタンプ）
> - パスワード変更
> - 2FA有効化/無効化
> - アカウントロック/ロック解除
> - セッション作成/破棄
> - 異常なアクセスパターン（例: 短時間に複数IPから）」

**保存期間**: 最低90日、推奨180日

### 監視とアラート

> 「以下の異常を検知してアラートを発してください：
> - 総当たり攻撃の兆候（短時間に大量のログイン試行）
> - アカウント列挙攻撃
> - 異常な地理的アクセス（例: 日本からログイン後、10分以内に米国からアクセス）
> - 大量のアカウントロック
> - セッションハイジャックの兆候」

---

## ペネトレーションテスト

### 実施時期

> 「実装完了後、本番リリース前に必ずペネトレーションテストを実施してください。外部のセキュリティ専門家に依頼し、OWASP Top 10の脆弱性がないことを確認してください。」

### チェック項目

- SQL Injection
- Cross-Site Scripting (XSS)
- Cross-Site Request Forgery (CSRF)
- Broken Authentication
- Sensitive Data Exposure
- Broken Access Control
- Security Misconfiguration
- Insecure Deserialization
- Using Components with Known Vulnerabilities
- Insufficient Logging & Monitoring

---

## セキュリティ設計レビュー

> 「設計段階で必ずセキュリティレビューを実施してください。私（佐藤）または代理のセキュリティエンジニアが参加します。実装前に脆弱性を発見することが重要です。」

**レビュー予定**: 1月30日

---

## インシデント対応

### 対応フロー

> 「セキュリティインシデント発生時の対応フローを事前に定義してください：
> 1. インシデント検知
> 2. 影響範囲の特定
> 3. 緊急対応（例: 該当アカウントの強制ログアウト）
> 4. 原因調査
> 5. 恒久対策
> 6. ユーザーへの通知（必要に応じて）
> 7. 再発防止策の実施」

### 通知義務

> 「GDPRでは、個人データ侵害を72時間以内に監督機関に通知する義務があります。また、個人情報保護法でも通知義務があります。インシデント対応チームと連携してください。」

---

## 開発チームへの推奨事項

### セキュアコーディング

> 「OWASP Secure Coding Practicesに従ってください。特に：
> - 入力検証（ホワイトリスト方式）
> - 出力エンコーディング
> - パラメータ化クエリ（SQLインジェクション対策）
> - CSRFトークンの使用
> - セキュアクッキー設定（HttpOnly, Secure, SameSite）」

### ライブラリの選定

> 「信頼できる、メンテナンスされているライブラリを使用してください。Rustエコシステムでは：
> - 認証: `actix-identity`, `tower-sessions`
> - パスワードハッシュ: `bcrypt`, `argon2`
> - JWT: `jsonwebtoken`
> - OAuth: `oauth2`
> - TOTP: `totp-lite`
>
> 既知の脆弱性がないか、定期的にチェックしてください（`cargo audit`）。」

---

## 成功の定義（セキュリティ観点）

1. **ペネトレーションテストで重大な脆弱性ゼロ**
2. **OWASP Top 10の脆弱性ゼロ**
3. **GDPR/個人情報保護法準拠**
4. **セキュリティインシデントゼロ（最初の3ヶ月）**
5. **セキュリティ監査で90点以上**

---

**インタビュー終了**: 15:30
**次回セキュリティレビュー**: 設計完了後（1/30予定）
